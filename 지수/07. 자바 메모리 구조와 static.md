## 07. 자바 메모리 구조와 static

### 자바 메모리 구조
![image](https://github.com/JavaGrowthSt/java-basic/assets/88030238/7549f419-81fa-402b-aa74-d1b476d4e84b)
자바의 메모리 구조는 크게 `메서드 영역`, `스택 영역`, `힙 영역` 3개로 나눌 수 있다.
- **`메서드 영역`** : **클래스 정보를 보관**
  - 비유하자면, `붕어빵 틀`을 보관하는 영역이다.
- **`스택 영역`** : **실제 프로그램이 실행되는 영역**
  - 메서드를 실행할 때마다 하나씩 쌓인다.
- **`힙 영역`** : **객체(인스턴스)가 생성되는 영역**
  - new 명령어를 사용하면 이 영역을 사용한다.
  - 배열도 이 영역에 생성된다.
  - 비유하자면, 붕어빵 틀로부터 생성된 `붕어빵`이 존재하는 영역이다.

![image](https://github.com/JavaGrowthSt/java-basic/assets/88030238/b13a49a8-0357-4966-9504-86cffdc0c8e6)

- **메서드 영역**
  - **프로그램을 실행하는데 필요한 공통 데이터**를 관리한다.
  - 프로그램의 모든 영역에서 공유한다.
  - 존재하는 것 : `클래스 정보`, `static 영역`, `런타임 상수 풀`
- **스택 영역**
  - 자바 실행 시, 하나의 실행 스택(스택 프레임)이 생성된다.
  - 각 스택 프레임은 `지역 변수`, `중간 연산 결과`, `메서드 호출 정보` 등을 포함한다.
  - **`스택 프레임`**
    - 스택 영역에 쌓이는 네모 박스
    - 메서드를 호출할 때마다 하나의 스택 프레임이 쌓이고, 메서드가 종료되면 해당 스택 프레임지 제거된다.
- **힙 영역**
  - 객체(인스턴스)와 배열이 생성되는 영역
  - 가비지 컬렉션(GC)이 이루어지는 주요 영역이다.

#### 💡 메서드 코드는 메서드 영역에서 공통으로 관리 및 실행된다.
![image](https://github.com/JavaGrowthSt/java-basic/assets/88030238/752482b2-e8ac-4a5d-b6bb-884a23ebedbd)

메소드는 인스턴스가 1개이든 100개이든 공통된 코드를 공유한다. 

특정 클래스로 100개의 인스턴스를 생성하면, 힙 메모리에 100개의 인스턴스가 생긴다. <br>
객체가 생성될 떄, 인스턴스 변수에는 메모리가 할당되지만, 메서드에 대한 새로운 메모리 할당은 없다. <br>
메서드는 메서드 영역에 생성된 코드를 공통으로 사용한다. <br>
동일한 메서드는 다 같은 코드를 사용하기 때문에, 이를위해 메모리를 할당하는 것은 메모리가 낭비이기 때문이다.

#### 💡 지역변수는 스택 영역에, 객체(인스턴스)는 힙 영역에서 관리된다.

### static 변수
- **`static`** 은 주로 `멤버변수`와 `메서드`에 사용된다.
- 멤버 변수에 static을 붙이면, `static 변수`, `정적 변수`, `클래스 변수`라고 한다.
- 클래스인 붕어빵 틀에서 특별히 관리하는 변수이다.
- `static`이 붙은 멤버 변수는 메서드 영역에서 관리한다.

```java
public class Data3 {
    public String name;
    public static int count;

    public Data3(String name) {
        this.name = name;
        count++;   // Data3.count++ 와 같다. 그런데, 같은 클래스이므로 앞에 붙은 Data3은 생략 가능
    }
}
```

static 변수는 인스턴스를 통한 접근도 가능하지만, 결국에는 클래스를 통한 접근을 할 때와 동일하게 메서드 영역에 접근하게 되는 것이다.
하지만, **개발자는 항상 해당 코드를 가져다 쓰는 사람을 고려해야 한다.**

static 변수임에도 불구하고 인스턴스를 통해 접근한다면, 
누군가 해당 코드를 보고 해당 변수가 인스턴스 변수라고 착각할 수 있다.

따라서, static 변수일 경우에는 클래스에 접근해서 사용하도록 코드를 작성하자.

#### 인스턴스 변수 vs. 클래스 변수
- 인스턴스 변수 : static이 붙지 않은 멤버 변수
  - 인스턴스를 생성해야 사용할 수 있고, 인스턴스에 소속되어 있다.
  - 인스턴스를 만들 때 마다 새로 맨들어진다.
- 클래스 변수 : static이 붙은 멤버 변수
  - 인스턴스와 무관하게 클래스에 바로 접근하여 사용할 수 있다.
  - 클래스 자체에 소속되어 있다.
  - 자바 프로그램을 시작할 때 오직 1개가 생성된다.
  - 보통 여러 곳에서 공유하는 목적으로 사용된다.

#### 변수와 생명주기
- 생존 주기
  - 지역 변수 < 인스턴스 변수 < 클래스 변수
- 지역 변수
  - 스택 영역의 스택 프레임 내부에 보관.
  - 메서드 종료됨과 동시에 스택 프레임이 제거되고, 동시에 지역 변수가 제거됨
- 인스턴스 변수
  - 힙 영역을 사용하는데, 해당 영역은 GC 발생 이전까지는 생존한다.
- 클래스 변수
  - 클래스 변수는 해당 클래스가 JVM에 로딩되는 순간 생성되고, JVM이 종료될 때 제거된다.

#### ❓ static? 정적?
- static 변수는 프로그램 실행 시점에 생성되고, 프로그램 종료 시점에 제거된다.
- 힙 영역에서 동적으로 생성 및 제거되는 인스턴스 변수와 어떤 차이가 있는지 생각해보면 된다.

### static 메서드

인스턴스 변수는 인스턴스를 생성해야만 알 수 있음. 반면, static은 클래스 소속!

- 인스턴스 변수, 인스턴스 메서드 : static 메서드, static 변수 접근 가능
- static 메서드, static 변수 : 인스턴스 변수, 인스턴스 메서드 접근 불가능


**💡 static은 static만 접근 가능! 반면, 모든 곳에서 static에 접근 가능하다.**
